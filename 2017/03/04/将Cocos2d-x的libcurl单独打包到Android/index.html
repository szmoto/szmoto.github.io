<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>将Cocos2d-x的libcurl单独打包到Android | 会思考的生活</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="http://blog.csdn.net/yuxikuo_1/article/details/41746869   研究了N久+N次，终于在这一周解决了，感谢度娘。感觉第一次快要跑通时，心里真是万分紧张，感觉什么都不会再爱了。点下按钮，返回预期的值，OK。搞定，为此，放松了一个上午，现在来写写一些我是怎么搞通的吧。不敢保证，每个库都能这么搞，但是对一些刚入门者，应该有帮助。好的，开讲！ 1、研究">
<meta name="keywords" content="Android,Cocos2d,cocos2d,android">
<meta property="og:type" content="article">
<meta property="og:title" content="将Cocos2d-x的libcurl单独打包到Android">
<meta property="og:url" content="http://blog.idingsong.cn/2017/03/04/将Cocos2d-x的libcurl单独打包到Android/index.html">
<meta property="og:site_name" content="会思考的生活">
<meta property="og:description" content="http://blog.csdn.net/yuxikuo_1/article/details/41746869   研究了N久+N次，终于在这一周解决了，感谢度娘。感觉第一次快要跑通时，心里真是万分紧张，感觉什么都不会再爱了。点下按钮，返回预期的值，OK。搞定，为此，放松了一个上午，现在来写写一些我是怎么搞通的吧。不敢保证，每个库都能这么搞，但是对一些刚入门者，应该有帮助。好的，开讲！ 1、研究">
<meta property="og:updated_time" content="2017-06-24T10:21:17.969Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="将Cocos2d-x的libcurl单独打包到Android">
<meta name="twitter:description" content="http://blog.csdn.net/yuxikuo_1/article/details/41746869   研究了N久+N次，终于在这一周解决了，感谢度娘。感觉第一次快要跑通时，心里真是万分紧张，感觉什么都不会再爱了。点下按钮，返回预期的值，OK。搞定，为此，放松了一个上午，现在来写写一些我是怎么搞通的吧。不敢保证，每个库都能这么搞，但是对一些刚入门者，应该有帮助。好的，开讲！ 1、研究">
  
    <link rel="alternate" href="/atom.xml" title="会思考的生活" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">会思考的生活</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">Thinking about Me.</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="Flux RSS"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Rechercher"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://blog.idingsong.cn"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-将Cocos2d-x的libcurl单独打包到Android" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/03/04/将Cocos2d-x的libcurl单独打包到Android/" class="article-date">
  <time datetime="2017-03-04T07:22:46.000Z" itemprop="datePublished">2017-03-04</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      将Cocos2d-x的libcurl单独打包到Android
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <blockquote>
<p><a href="http://blog.csdn.net/yuxikuo_1/article/details/41746869" target="_blank" rel="external">http://blog.csdn.net/yuxikuo_1/article/details/41746869</a></p>
</blockquote>
<p><span id="more-64"></span></p>
<p>研究了N久+N次，终于在这一周解决了，感谢度娘。感觉第一次快要跑通时，心里真是万分紧张，感觉什么都不会再爱了。点下按钮，返回预期的值，OK。搞定，为此，放松了一个上午，现在来写写一些我是怎么搞通的吧。不敢保证，每个库都能这么搞，但是对一些刚入门者，应该有帮助。好的，开讲！</p>
<h2 id="1、研究背景与意义"><a href="#1、研究背景与意义" class="headerlink" title="1、研究背景与意义"></a><a name="t0"></a>1、研究背景与意义</h2><div>公司要单独封装网络库，所以，首先想到的libcurl，因为搞过半年Cocos2d-x，所以，直接找到了Cocos2d-x引擎源码的预编译第三方库里的libcurl。什么是预编译库？下面来解释解释。</div>

<h3 id="1-1预编译库"><a href="#1-1预编译库" class="headerlink" title="1.1预编译库"></a><a name="t1"></a>1.1预编译库</h3><div>所谓预编译库其实就是静态库，是一种可执行代码的二进制形式，可以被操作系统载入内存执行。在Linux或Unix下是以.a结尾的库文件。库文件首先会进行编译，当我们把库文件导入自己的动态或静态文件或工程中时，会提高代码的编译速度。静态库在代码编译的时候是已经被载入可执行程序的，体积较大，动态库是在执行程序时才载入内存，在编译的过程中简单的引用，因此代码体积较小。</div><br><div>这篇文章详细讲解了Linux下静态和动态库的基础知识。<a href="http://blog.csdn.net/abc19842008/article/details/1923159" target="_blank" rel="external">Linux库详解</a></div>

<h3 id="1-2libcurl"><a href="#1-2libcurl" class="headerlink" title="1.2libcurl"></a><a name="t2"></a>1.2libcurl</h3><div>Libcurl是一个开源免费的库文件，客户端传输库，支持FTP、FTPS、TFTP、HTTP、HTTPS、GOPHER、TELENT、DICT、FILE、LDAP等，C语言编写，跨平台，支持Windows、Unix、Linux等，线程安全，支持Ipv6，易于使用。</div><br><div>官网下载地址：<a href="http://curl.haxx.se/download.html" target="_blank" rel="external">http://curl.haxx.se/download.html</a></div><br><div>官网API详解：<a href="http://curl.haxx.se/libcurl/c/" target="_blank" rel="external">http://curl.haxx.se/libcurl/c/</a></div><br><div>其实主要是4个函数：1）curl_easy_init()初始化;2）curl_easy_setopt()设置属性;3）curl_easy_perform，连接。4）curl_easy_getinfo</div><br><div>这篇文章详细介绍了如何使用libcurl将下载内容写入内存：<a href="http://blog.163.com/xu_chao2000/blog/static/27770610200801303252802/" target="_blank" rel="external">http://blog.163.com/xu_chao2000/blog/static/27770610200801303252802/</a></div>

<h2 id="2、打包Android版libcurl包"><a href="#2、打包Android版libcurl包" class="headerlink" title="2、打包Android版libcurl包"></a><a name="t3"></a>2、打包Android版libcurl包</h2><div>关于打包libcurl包，网上有非常多的教程，由于Cocos2d-x已经为我们提供了几乎大部分平台的预编译库，即.a文件。所以，这一步我就在这省略了，虽然可能网上的教程有的比较坑爹，不过，多花些时间，综合起来，就会凑成一个完美的解决方案。</div>

<h2 id="3、开始打包"><a href="#3、开始打包" class="headerlink" title="3、开始打包"></a><a name="t4"></a>3、开始打包</h2><div>在打包之前，我们可能需要学一下JNI和NDK编程的知识，不过，这些知识，也不是一篇两篇文章能解释清楚的，所以，这里也不打算讲解，有兴趣的可以翻看本人之前的博客，或者网上百度会有大篇大篇的文章。</div>

<h3 id="3-1新建Android空工程"><a href="#3-1新建Android空工程" class="headerlink" title="3.1新建Android空工程"></a><a name="t5"></a>3.1新建Android空工程</h3><div>使用Eclipse新建Android工程。</div><br><div>1）由于Android本身新建工程并不包含jni目录，所以，我们需要自己添加该目录，并在该目录下添加两个文件。Android.mk和Application.mk这两个文件是ndk-build使用的文件。</div><br><div>2）拷贝Cocos2d-x的预编译库。我们需要的libcurl预编译库在Cocos2d-x引擎cocos2d-x-3.3rc0/external/curl目录下，将该目录下的两个文件include和prebuilt拷贝到我们上一步新建的android工程中。</div><br><div>3）删除include和prebuilt两个目录中android目录之外的的平台目录。因为我们用不到那些</div><br><div>4）更新Eclipse，可以看到，我们刚才的操作过后的目录如下：重点是jni目录下的改变（网络限制，暂时传不上来照片）</div>

<h3 id=""><a href="#" class="headerlink" title=""></a><a name="t6"></a></h3><h3 id="3-2先来一个简单例子，抛砖引玉"><a href="#3-2先来一个简单例子，抛砖引玉" class="headerlink" title="3.2先来一个简单例子，抛砖引玉"></a><a name="t7"></a>3.2先来一个简单例子，抛砖引玉</h3><p><a href="http://lib.csdn.net/base/15" title="undefined" target="_blank" rel="external">Android</a>.mk文件可以说是本文最终要的一部分。我们先一步一步去讲一讲它。</p>
<p>首先阅读下这篇文章，预热一下，了解了解打包静态库和动态库的方法。</p>
<p>其次我们从NDK的samples的two-libs例子入手，分析mk的写法。（即搭建Android环境时，解压的NDK目录下的samples/two-libs）</p>
<p>先上代码</p>
<p>1）first文件：定义了一个加法的方法</p>
<div class="dp-highlighter bg_cpp"><br><div class="bar"><br><div class="tools"><br><pre class="crayon-plain-tag">//first.h<br>#ifndef FIRST_H<br>#define FIRST_H<br><br>extern int first(int  x, int  y);<br><br>#endif /<em> FIRST_H </em>/<br><br>//first.c<br>#include “first.h”<br>int  first(int  x, int  y)<br>{<br>    return x + y;<br>}</pre><br><br>2）second.c：这个文件是Jni的相关的文件。<p></p><br></div><br></div><br></div><br><div class="dp-highlighter bg_cpp"><br><div class="bar"><br><div class="tools"><br><pre class="crayon-plain-tag">//second.c<br>#include “first.h”<br>#include &lt;jni.h&gt; //添加jni头文件<br>//下面这个函数的意思就是com.example.twolibs包com.example.androidlibcurldemo下MainActivity.java中的add方法。<br>jint<br>Java_com_example_androidlibcurldemo_MainActivity_add( JNIEnv*  env,<br>                                      jobject  this,<br>                                      jint     x,<br>                                      jint     y )<br>{<br>    return first(x, y);<br>}</pre><br><br>这个add方法，是在我们上一步创建工程的src目录下的MainActivity.java中声明的两个native方法，说白了，second.c的作用就是，定义java中的native方法，并在实现中调用C的代码，如first.c中的first函数。相当于一个中介的样子。<p></p><br></div><br></div><br></div>

<p>3）Android.mk：例子中的Android.mk文件</p>
<div class="dp-highlighter bg_cpp"><br><div class="bar"><br><div class="tools"><br><pre class="crayon-plain-tag">#定义变量LOCAL_PATH指向mk所在的路径，如Android.mk文件在/usr/lib/curl/Android.mk<br>#那么LOCAL_PATH代表的值就是：/usr/lib/curl<br>#注意，这个变量没有清理，如果在后面引入其他mk文件，这个变量是可以传递到引入的mk文件中的<br><br>LOCAL_PATH:= $(call my-dir)<br><br># first lib, which will be built statically<br>#CLEAR_VARS清理变量，因为这些变量都是静态全局的，如果不清了，下次编译时用到这些变量就会造成错误的<br>include $(CLEAR_VARS)<br>#本地静态库模块名字，如果在别处导入库文件时，会用到这个名字<br>#此处名字的使用是libXXX.so或libXXX.a中的XXX的名字，也可以libXXX，不过，这两种在使用上还是有点区别的，<br>#使用XXX或libXXX最后打包库后都是libXXX.a/so,在导入库模块时要使用LOCAL_LDLIBS := -lz来指明导入的是本地库<br>#否则会报找不到库的错误<br>LOCAL_MODULE    := libtwolib-first<br>LOCAL_SRC_FILES := first.c<br>#创建静态库，注意，这个库是我们第一次创建，所以使用BUILD_STATIC_LIBRARY<br>#如果LOCAL_SRC_FILES（即源码文件）使用的是.a则使用include $(PREBUILT_STATIC_LIBRARY)，见下面代码<br>#如果使用的是.so文件，则使用include $(PREBUILT_SHARED_LIBRARY)，PREBUILT表示使用的是预编译库里的源文件<br>include $(BUILD_STATIC_LIBRARY)<br><br># second lib, which will depend on and include the first one<br>#清理变量<br>include $(CLEAR_VARS)<br>#模块名称<br>LOCAL_MODULE    := libtwolib-second<br>#源码文件<br>LOCAL_SRC_FILES := second.c<br>#导入关联的静态库，如果还有其它静态库，直接在后面添加即可，注意空格隔开<br>LOCAL_STATIC_LIBRARIES := libtwolib-first<br>#最终创建动态库文件，libtwolib-second.so<br>#如果最终创建静态库文件，是需要把SHARED改为STATIC即可，如libtwolib-first<br>include $(BUILD_SHARED_LIBRARY)</pre><br><br>4）Application.mk<p></p><br></div><br></div><br></div>

<p>我们在这个mk文件中只添加APP_ABI := all NDK就会为我们自动打包对应不同平台ABI的库文件，不同平台的库文件还是有区别的。</p>
<p>不过现在的Android手机大部分都是armeabi的，所以，如果不添加这句话，NDK默认的就会生成armeabi目录，并编译这个平台下使用的库文件。</p>
<p>5）编译库文件</p>
<p>我们进入到创建的Android工程，根目录即可，打开终端，如我使用的mac，打开终端后输入：</p>
<p>$ cd /Users/yuxikuo/Android_WorkPlace/AndroidLibcurlDemo</p>
<p>$  ndk-build</p>
<div class="dp-highlighter bg_cpp"><br><div class="bar"><br><div class="tools"><br><pre class="crayon-plain-tag">Android NDK: WARNING: APP_PLATFORM android-19 is larger than android:minSdkVersion 8 in ./AndroidManifest.xml<br>[armeabi] Compile thumb  : twolib-second &lt;= second.c<br>[armeabi] Compile thumb  : twolib-first &lt;= first.c<br>[armeabi] StaticLibrary  : libtwolib-first.a<br>[armeabi] SharedLibrary  : libtwolib-second.so<br>[armeabi] Install        : libtwolib-second.so =&gt; libs/armeabi/libtwolib-second.so</pre><br><br>打包后的结果如上：Android中NDK将打包后的包文件拷贝到1）工程目录下的libs/下对应ABI目录下面，ABI表示当前机器的操作系统，一共有4类，不同的目标系统ABI有不同的打包方式和兼容性。2）同时还会在工程目录新建obj/local目录，该目录下同样根据不同的ABI拷贝对应的库文件。不过，不同的ABI目录是需要自己新建的，默认下是armeabi，因为大部分Android使用的是这个，并且它可以运行在所有ARM CPU上。<p></p><br></div><br></div><br></div>

<p>armeabi   =&gt;    ARMv5TE以上</p>
<p>armeabi-v7a  =&gt;  ARMv7以上</p>
<p>x86   =&gt;   x86平台</p>
<p>mips =&gt; mips</p>
<p>由于根据不同的ABI进行打包，那么我们每次都会生成4个包，打包过程见下面代码。</p>
<p>而且现在其他的平台并不常见，而且armeabi对其他平台也有兼容，所以，我们这里暂时只考虑armeabi平台下库文件的打包。</p>
<div class="dp-highlighter bg_cpp"><br><div class="bar"><br><div class="tools"><br><pre class="crayon-plain-tag">Android NDK: WARNING: APP_PLATFORM android-19 is larger than android:minSdkVersion 8 in ./AndroidManifest.xml<br>[armeabi-v7a] Compile thumb  : twolib-second &lt;= second.c<br>[armeabi-v7a] Compile thumb  : twolib-first &lt;= first.c<br>[armeabi-v7a] StaticLibrary  : libtwolib-first.a<br>[armeabi-v7a] SharedLibrary  : libtwolib-second.so<br>[armeabi-v7a] Install        : libtwolib-second.so =&gt; libs/armeabi-v7a/libtwolib-second.so //armeabi-v7a<br>[armeabi] Compile thumb  : twolib-second &lt;= second.c<br>[armeabi] Compile thumb  : twolib-first &lt;= first.c<br>[armeabi] StaticLibrary  : libtwolib-first.a<br>[armeabi] SharedLibrary  : libtwolib-second.so<br>[armeabi] Install        : libtwolib-second.so =&gt; libs/armeabi/libtwolib-second.so  //armeabi<br>[x86] Compile        : twolib-second &lt;= second.c<br>[x86] Compile        : twolib-first &lt;= first.c<br>[x86] StaticLibrary  : libtwolib-first.a<br>[x86] SharedLibrary  : libtwolib-second.so<br>[x86] Install        : libtwolib-second.so =&gt; libs/x86/libtwolib-second.so  //x86<br>[mips] Compile        : twolib-second &lt;= second.c<br>[mips] Compile        : twolib-first &lt;= first.c<br>[mips] StaticLibrary  : libtwolib-first.a<br>[mips] SharedLibrary  : libtwolib-second.so<br>[mips] Install        : libtwolib-second.so =&gt; libs/mips/libtwolib-second.so   //mips</pre><br><br>6）在Java代码中调用。<p></p><br></div><br></div><br></div>

<p>在MainActivity.java中添加如下代码</p>
<div class="dp-highlighter bg_java"><br><div class="bar"><br><div class="tools"><br><pre class="crayon-plain-tag">@Override<br>   protected void onCreate(Bundle savedInstanceState) {<br>       super.onCreate(savedInstanceState);<br><br>       //super.onCreate(savedInstanceState);<br><br>       TextView  tv = new TextView(this);<br>       int       x  = 1000;<br>       int       y  = 42;<br><br>       // here, we dynamically load the library at runtime<br>       // before calling the native method.<br>       //把生成的库load进来，注意去掉libXXX.so中的lib和so。只保留XXX<br>       System.loadLibrary(“twolib-second”);<br><br>       int  z = add(x, y);<br><br>       tv.setText( “The sum of “ + x + “ and “ + y + “ is “ + z );<br>       setContentView(tv);<br>   }<br><br>   public native int add(int  x, int  y);//native函数声明，在我们的second.c文件中定义，并使用了first.c中的first函数，实现加法</pre><br><br>注意，如果出现错误或崩溃，看看second.c的函数包名是不是错误，然后看看有没有在java中声明native的add方法<p></p><br></div><br></div><br></div>

<p>截图稍后上传。</p>
<h3 id="3-3重头戏-使用libcurl-a打包的so库到Android"><a href="#3-3重头戏-使用libcurl-a打包的so库到Android" class="headerlink" title="3.3重头戏:使用libcurl.a打包的so库到Android"></a><a name="t8"></a>3.3重头戏:使用libcurl.a打包的so库到Android</h3><p>1）首先，看看我们之前拷贝到jni目录下的两个文件夹include和prebuilt。对了，这两个目录是我阉割的，把其它无关平台的目录删除了。</p>
<p>2）include目录下是libcurl.a库中源文件的头文件。我们也需要将它打包进包里面，才能在涉及到包时，自动引入头文件。</p>
<p>3）prebuilt目录是存放libcurl.a的目录，我们暂时保存Cocos2d-x的目录结构，这样，我们就免得修改下面的Android.mk文件了</p>
<p>4）/prebuilt/android目录下的Android.mk分析：</p>
<p>注意为了减少路径上的问题，我将include文件夹拷贝到了和该Android.mk文件相同的路径下了</p>
<div class="dp-highlighter bg_java"><br><div class="bar"><br><div class="tools"><br><pre class="crayon-plain-tag">LOCAL_PATHA:=$(call my-dir)//当前路径变量，注意，我在该处设置的变量名是LOCAL_PATHA，因为后面需要导入这个mk文件，防止变量冲突<br>include $(CLEAR_VARS)//清理变量<br>LOCAL_MODULE := cocos_curl_static //模块名称<br>LOCAL_MODULE_FILENAME := curl  //生成的包名<br>LOCAL_SRC_FILES := prebuilt/android/$(TARGET_ARCH_ABI)/libcurl.a  //依赖的源文件，注意：路径一定要为相对路径，这一块比较容易出错<br>LOCAL_EXPORT_C_INCLUDES := $(LOCAL_PATHA)/include/android  //为了能在库外面使用库的方法，需要引入头文件<br>include $(PREBUILT_STATIC_LIBRARY)//预编译成静态库</pre><br><br>4）目录下的Android.mk分析：<p></p><br></div><br></div><br></div><br><div class="dp-highlighter bg_java"><br><div class="bar"><br><div class="tools"><br><pre class="crayon-plain-tag">LOCAL_PATH:=$(call my-dir)<br>#修改1<br>include $(LOCAL_PATH)/prebuilt/android/Android.mk<br># first lib, which will be built statically<br>#<br>include $(CLEAR_VARS)<br><br>LOCAL_MODULE    := libtwolib-first<br>LOCAL_SRC_FILES := first.c<br><br>include $(BUILD_STATIC_LIBRARY)<br><br># second lib, which will depend on and include the first one<br>#<br>include $(CLEAR_VARS)<br><br>LOCAL_MODULE    := libtwolib-second<br>LOCAL_SRC_FILES := second.c<br>#修改2，尤其是-lz的作用，非常大<br>LOCAL_C_INCLUDES := $(LOCAL_PATH)<br>LOCAL_LDLIBS := -llog \<br>        -lz<br>#修改3，增加cocos_curl_static库的导入，这就是我们在上面mk定义的<br>LOCAL_STATIC_LIBRARIES := libtwolib-first cocos_curl_static<br><br>include $(BUILD_SHARED_LIBRARY)</pre><br><br>5）重写second.c，调用libcurl中的方法，进行网络请求<p></p><br></div><br></div><br></div><br><div class="dp-highlighter bg_java"><br><div class="bar"><br><div class="tools"><br><pre class="crayon-plain-tag">#include “first.h”<br>#include &lt;jni.h&gt;<br>#include &lt;curl/curl.h&gt;<br><br>jint<br>Java_com_example_androidlibcurldemo_MainActivity_add( JNIEnv<em>  env,<br>                                      jobject  this,<br>                                      jint     x,<br>                                      jint     y )<br>{<br>    CURL</em> curl;<br>    CURLcode res;<br>    curl = curl_easy_init();<br>    if(NULL == curl)//如果初始化失败，返回1000<br>    {<br>        return first(1,999);<br>    }<br>    curl_easy_setopt(curl, CURLOPT_URL,”<a href="http://www.baidu.com&quot;);//以get请求www.baidu.com" target="_blank" rel="external">http://www.baidu.com&quot;);//以get请求www.baidu.com</a><br>    curl_easy_setopt(curl, CURLOPT_READFUNCTION,NULL);<br>    curl_easy_setopt(curl, CURLOPT_NOSIGNAL,1);<br>    curl_easy_setopt(curl, CURLOPT_CONNECTTIMEOUT,20);//连接时间，由于网络不好，为了达到测试效果，我设置的时间较长<br>    curl_easy_setopt(curl, CURLOPT_TIMEOUT,20);<br>    res = curl_easy_perform(curl);//执行<br>    curl_easy_cleanup(curl);//清除<br>&lt;span style=”white-space:pre”&gt;    &lt;/span&gt;<br>    return first(res,res);//根据res值返回到Android中的TextView中，如果res是0，表示请求成功，如果是6表示无法解析主机，即没联网<br>}</pre><br><br>6）编译库文件<p></p><br></div><br></div><br></div>

<p>同样还是在终端中，先进入到Android工程目录，然后执行ndk-build。最终在obj和libs目录下生成了我们的libtwolib-second库</p>
<h3 id="3-4如何使用库"><a href="#3-4如何使用库" class="headerlink" title="3.4如何使用库"></a><a name="t9"></a>3.4如何使用库</h3><div>1）首先，还是要修改我们的MainActivity.java类，修改如下：</div><br><div><br><div class="dp-highlighter bg_java"><br><div class="bar"><br><div class="tools"><br><pre class="crayon-plain-tag">private Button button;<br>    private TextView tv;<br>    private int x  = 123;<br>    private int y  = 456;<br>    @Override<br>    protected void onCreate(Bundle savedInstanceState) {<br>        super.onCreate(savedInstanceState);<br>        setContentView(R.layout.activity_main);<br>        // here, we dynamically load the library at runtime<br>        // before calling the native method.<br>        //<br>        System.loadLibrary(“twolib-second”);<br><br>        tv = (TextView)findViewById(R.id.textView2);<br>        button = (Button) this.findViewById(R.id.button1);<br>        this.button.setOnClickListener(new OnClickListener() {<br><br>            @Override<br>            public void onClick(View arg0) {<br>                 int  z = add(x, y);<br>                 tv.setText( “网络请求结果” + z );<br>            }<br>        });<br>    }<br><br>    public native int add(int  x, int  y);</pre><br><br>我们要在activity_main布局中，添加一个按钮和一个TextView，按钮用于出发网络请求，TextView用于显示请求结果。<p></p><br></div><br></div><br></div><br></div><br><div>显示0表示请求成功。显示12表示无法解析主机，没联网。</div><br><div>2）在AndroidManifest.xml中添加网络权限。否则会在TextView显示12</div><br><div><br><br><u>&lt;</u><u>uses-permission</u><u> </u><u>android:name</u><u>=</u>&#8220;android.permission.INTERNET&#8221;<u>/&gt;</u><br><br>至此，我们就完成了库的编译和使用。<br><br></div><br><div>Ctrl+R 打包APK到手机，点击button测试吧。不过这是同步请求，异步暂时还未研究。</div><br><div></div><br><div>以上步骤是经过真机测试，截图如下：网络限制，稍后上传。</div><br><div></div><br><div>疑惑：打包时，如果我没有在second.c中引用&lt;curl/curl.h&gt;进行打包，包只有几十kb，引用后就1.2MB了，但是，我看了下libcurl.a的库本身就4点几MB，不知道什么原因，如有知道，烦请告知。</div>

<p>参考资料：</p>
<p>1）<a href="http://blog.csdn.net/sozell/article/details/10551309" target="_blank" rel="external">http://blog.csdn.net/sozell/article/details/10551309</a></p>
<p>2）<a href="http://www.2cto.com/kf/201204/125939.html" target="_blank" rel="external">http://www.2cto.com/kf/201204/125939.html</a></p>
<p>3）<a href="http://jingyan.baidu.com/article/c910274bffa502cd361d2da0.html" target="_blank" rel="external">http://jingyan.baidu.com/article/c910274bffa502cd361d2da0.html</a></p>
<p>4）<a href="http://blog.csdn.net/smfwuxiao/article/details/6591927" target="_blank" rel="external">http://blog.csdn.net/smfwuxiao/article/details/6591927</a></p>
<p>5）<a href="http://www.cnblogs.com/lyout/archive/2013/06/03/3115799.html" target="_blank" rel="external">http://www.cnblogs.com/lyout/archive/2013/06/03/3115799.html</a></p>
<p>6）<a href="http://www.linuxidc.com/Linux/2012-07/66105.htm" target="_blank" rel="external">http://www.linuxidc.com/Linux/2012-07/66105.htm</a></p>
<p>7）<a href="http://blog.csdn.net/smfwuxiao/article/details/8523479" target="_blank" rel="external">http://blog.csdn.net/smfwuxiao/article/details/8523479</a></p>
<p>8）<a href="http://blog.csdn.net/yuxikuo_1/article/details/39577257" target="_blank" rel="external">http://blog.csdn.net/yuxikuo_1/article/details/39577257</a></p>
<p>9）<a href="http://bbs.csdn.net/topics/370006153" target="_blank" rel="external">http://bbs.csdn.net/topics/370006153</a></p>
<p>10）<a href="http://blog.csdn.net/huyiyang2010/article/details/7664201" target="_blank" rel="external">http://blog.csdn.net/huyiyang2010/article/details/7664201</a></p>
<p>11）<a href="http://blog.csdn.net/cjj198561/article/details/33417965" target="_blank" rel="external">http://blog.csdn.net/cjj198561/article/details/33417965</a></p>
<p>12）<a href="http://bbs.chinaunix.net/thread-4096875-1-1.html" target="_blank" rel="external">http://bbs.chinaunix.net/thread-4096875-1-1.html</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.idingsong.cn/2017/03/04/将Cocos2d-x的libcurl单独打包到Android/" data-id="cj4b50iwj000aigplbxyud8mx" class="article-share-link">Partager</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Android/">Android</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Cocos2d/">Cocos2d</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/android/">android</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/cocos2d/">cocos2d</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2017/03/04/Android-NDK编译选项设置/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Récent</strong>
      <div class="article-nav-title">
        
          Android NDK编译选项设置
        
      </div>
    </a>
  
  
    <a href="/2017/03/03/使用NDK自带的iconv进行编码转换/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Ancien</strong>
      <div class="article-nav-title">使用NDK自带的iconv进行编码转换</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Mot-clés</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Android/">Android</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Cocos2d/">Cocos2d</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JSP/">JSP</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Java/">Java</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JavaEE/">JavaEE</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/VS/">VS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/VisualStudio/">VisualStudio</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Wordpress/">Wordpress</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/android/">android</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/choco/">choco</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/cocos2d/">cocos2d</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/game/">game</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ide/">ide</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/libgdx/">libgdx</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ndk/">ndk</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tools/">tools</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/visualstudio/">visualstudio</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Nuage de mot-clés</h3>
    <div class="widget tagcloud">
      <a href="/tags/Android/" style="font-size: 20px;">Android</a> <a href="/tags/Cocos2d/" style="font-size: 15px;">Cocos2d</a> <a href="/tags/JSP/" style="font-size: 10px;">JSP</a> <a href="/tags/Java/" style="font-size: 15px;">Java</a> <a href="/tags/JavaEE/" style="font-size: 10px;">JavaEE</a> <a href="/tags/VS/" style="font-size: 10px;">VS</a> <a href="/tags/VisualStudio/" style="font-size: 10px;">VisualStudio</a> <a href="/tags/Wordpress/" style="font-size: 10px;">Wordpress</a> <a href="/tags/android/" style="font-size: 15px;">android</a> <a href="/tags/choco/" style="font-size: 10px;">choco</a> <a href="/tags/cocos2d/" style="font-size: 15px;">cocos2d</a> <a href="/tags/game/" style="font-size: 15px;">game</a> <a href="/tags/ide/" style="font-size: 10px;">ide</a> <a href="/tags/libgdx/" style="font-size: 10px;">libgdx</a> <a href="/tags/ndk/" style="font-size: 15px;">ndk</a> <a href="/tags/tools/" style="font-size: 10px;">tools</a> <a href="/tags/visualstudio/" style="font-size: 10px;">visualstudio</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/06/">六月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/04/">四月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">三月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/02/">二月 2017</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Articles récents</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2017/06/24/Test/">Test</a>
          </li>
        
          <li>
            <a href="/2017/06/24/hello-world/">Hello World</a>
          </li>
        
          <li>
            <a href="/2017/04/08/wordpress中文路径出现404错误的解决办法/">wordpress中文路径出现404错误的解决办法</a>
          </li>
        
          <li>
            <a href="/2017/04/08/java-IO流文件的读写具体实例/">java IO流文件的读写具体实例</a>
          </li>
        
          <li>
            <a href="/2017/03/25/IntelliJ-IDEA-2016-1建立Strut2工程并使用Tomcat调试/">IntelliJ IDEA 2016.1建立Strut2工程并使用Tomcat调试</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2017 i_D.S.<br>
      Propulsé by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>